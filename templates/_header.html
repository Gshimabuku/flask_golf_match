{# ヘッダーコンポーネント - 固定ハンバーガーメニュー対応 #}
{# 使用方法: 
   {% raw %}{% set header_title = "ページタイトル" %}{% endraw %}
   {% raw %}{% set action_button = {'text': '新規作成', 'id': 'new-button'} %}{% endraw %} {# オプション #}
   {% raw %}{% include '_header.html' %}{% endraw %}
#}

<div class="page-header">
    <button type="button" class="hamburger-btn" id="hamburger-toggle">
        <span></span>
        <span></span>
        <span></span>
    </button>
    <h1>{{ header_title|default('ページタイトル') }}</h1>
    <div class="page-header-buttons">
        {# ページ固有のアクションボタン（新規作成など） #}
        {% if action_button %}
        <button type="button" class="action-btn" id="{{ action_button.id }}">{{ action_button.text }}</button>
        {% endif %}
        
        {# 戻るボタン（ホーム以外のページで表示） #}
        {% if request.endpoint != 'home' %}
        <button type="button" class="back-btn" id="back-button">戻る</button>
        {% endif %}
    </div>
</div>

{# ハンバーガーメニュー（全ページで表示） #}
<div class="hamburger-overlay" id="hamburger-overlay"></div>
<div class="hamburger-menu" id="hamburger-menu">
    <div class="hamburger-menu-header">
        <div class="hamburger-menu-title">メニュー</div>
        <button type="button" class="hamburger-close-btn" id="hamburger-close">×</button>
    </div>
    <div class="hamburger-menu-items">
        <button type="button" class="hamburger-menu-item" id="home-button">ホーム</button>
        <button type="button" class="hamburger-menu-item" id="new-round-button">新規ラウンド</button>
        <button type="button" class="hamburger-menu-item" id="round-list-button">過去ラウンド</button>
        <button type="button" class="hamburger-menu-item" id="course-list-button">コース一覧</button>
    </div>
</div>

<script>
    // ハンバーガーメニュー制御
    (function() {
        const hamburgerToggle = document.getElementById('hamburger-toggle');
        const hamburgerMenu = document.getElementById('hamburger-menu');
        const hamburgerOverlay = document.getElementById('hamburger-overlay');
        const hamburgerClose = document.getElementById('hamburger-close');

        if (!hamburgerToggle) return;

        function openHamburgerMenu() {
            hamburgerMenu.classList.add('active');
            hamburgerOverlay.classList.add('active');
            hamburgerToggle.classList.add('active');
        }

        function closeHamburgerMenu() {
            hamburgerMenu.classList.remove('active');
            hamburgerOverlay.classList.remove('active');
            hamburgerToggle.classList.remove('active');
        }

        hamburgerToggle.addEventListener('click', function() {
            if (hamburgerMenu.classList.contains('active')) {
                closeHamburgerMenu();
            } else {
                openHamburgerMenu();
            }
        });

        hamburgerClose.addEventListener('click', closeHamburgerMenu);
        hamburgerOverlay.addEventListener('click', closeHamburgerMenu);

        // ハンバーガーメニュー内のボタンがクリックされたら閉じる
        document.querySelectorAll('.hamburger-menu-item').forEach(function(item) {
            item.addEventListener('click', closeHamburgerMenu);
        });

        // ハンバーガーメニュー内のボタンのナビゲーション処理
        const homeButton = document.getElementById('home-button');
        if (homeButton) {
            homeButton.addEventListener('click', function () {
                location.href = '{{ url_for("home") }}';
            });
        }

        const newRoundButton = document.getElementById('new-round-button');
        if (newRoundButton) {
            newRoundButton.addEventListener('click', function () {
                location.href = '{{ url_for("round_new") }}';
            });
        }

        const roundListButton = document.getElementById('round-list-button');
        if (roundListButton) {
            roundListButton.addEventListener('click', function () {
                location.href = '{{ url_for("round_list") }}';
            });
        }

        const courseListButton = document.getElementById('course-list-button');
        if (courseListButton) {
            courseListButton.addEventListener('click', function () {
                location.href = '{{ url_for("course_list") }}';
            });
        }

        const backButton = document.getElementById('back-button');
        if (backButton) {
            backButton.addEventListener('click', function () {
                // 戻るボタンは各ページで異なる動作をするため、カスタムイベントを発火
                const event = new CustomEvent('header-back-clicked');
                document.dispatchEvent(event);
            });
        }
    })();
</script>
